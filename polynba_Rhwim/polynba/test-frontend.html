<!DOCTYPE html>
<html>
<head>
    <title>PolyArena Frontend Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>PolyArena å‰ç«¯æµ‹è¯•</h1>
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');

        async function testAPI() {
            results.innerHTML += '<h2>æµ‹è¯• 1: API Endpoint</h2>';

            try {
                const response = await fetch('http://localhost:3004/api/polymarket?tag=NBA&limit=2');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                results.innerHTML += `<p class="success">âœ… API è¿”å›æˆåŠŸ</p>`;
                results.innerHTML += `<p class="info">è¿”å› ${data.length} ä¸ªå¸‚åœº</p>`;

                if (data.length > 0) {
                    const event = data[0];
                    results.innerHTML += `<p class="info">ç¬¬ä¸€ä¸ªå¸‚åœºæ ‡é¢˜: ${event.title}</p>`;
                    results.innerHTML += `<p class="info">Series: ${JSON.stringify(event.series)}</p>`;
                    results.innerHTML += `<p class="info">Markets: ${event.markets ? 'Yes' : 'No'}</p>`;
                }

                return data;
            } catch (error) {
                results.innerHTML += `<p class="error">âŒ API é”™è¯¯: ${error.message}</p>`;
                return null;
            }
        }

        async function testDataTransformation() {
            results.innerHTML += '<h2>æµ‹è¯• 2: æ•°æ®è½¬æ¢</h2>';

            const data = await testAPI();
            if (!data || data.length === 0) {
                results.innerHTML += '<p class="error">âŒ æ— æ•°æ®å¯æµ‹è¯•</p>';
                return;
            }

            const event = data[0];

            // æ¨¡æ‹Ÿ eventToArenaMarket çš„é€»è¾‘
            let sportName = 'Sports';
            if (Array.isArray(event.series) && event.series.length > 0) {
                sportName = event.series[0].title || event.series[0].ticker || 'Sports';
            } else if (typeof event.series === 'string') {
                sportName = event.series;
            }

            results.innerHTML += `<p class="success">âœ… è¿åŠ¨ç±»å‹æå–æˆåŠŸ: ${sportName}</p>`;
            results.innerHTML += `<p class="info">ç±»å‹æ£€æŸ¥: ${typeof sportName === 'string' ? 'å­—ç¬¦ä¸² âœ…' : 'å¯¹è±¡ âŒ'}</p>`;

            if (typeof sportName !== 'string') {
                results.innerHTML += `<p class="error">âŒ é”™è¯¯ï¼sport åº”è¯¥æ˜¯å­—ç¬¦ä¸²ï¼Œä½†æ˜¯: ${typeof sportName}</p>`;
            }
        }

        async function runAllTests() {
            results.innerHTML = '<p class="info">ğŸ§ª å¼€å§‹æµ‹è¯•...</p>';
            await testDataTransformation();
            results.innerHTML += '<h2>æµ‹è¯•å®Œæˆ</h2>';
            results.innerHTML += '<p class="info">ç°åœ¨å¯ä»¥æ‰“å¼€ <a href="http://localhost:3004" target="_blank">http://localhost:3004</a> æŸ¥çœ‹å®é™…é¡µé¢</p>';
        }

        runAllTests();
    </script>
</body>
</html>
